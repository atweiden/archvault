#!/usr/bin/perl6




use v6;
use Holovault;




# -----------------------------------------------------------------------------
# help
# -----------------------------------------------------------------------------

multi sub MAIN('help', Str $command)
{
    given $command
    {
        when 'install'
        {
            USAGE('install');
        }
        when 'ls'
        {
            USAGE('ls');
        }
        default
        {
            USAGE();
        }
    }
}




# -----------------------------------------------------------------------------
# install
# -----------------------------------------------------------------------------

multi sub MAIN(
    'install',
    *%opts (
        Bool :$augment,
        Str :$disktype,
        Str :$graphics,
        Str :$holograms,
        Str :$holograms-dir,
        Str :$hostname,
        Str :$keymap,
        Str :$locale,
        Str :$partition,
        Str :$processor,
        Str :$rootpass,
        Str :$timezone,
        Str :$username,
        Str :$userpass,
        Str :$vaultname,
        Str :$vaultpass,
    )
)
{
    Holovault.install(|%opts);
}




# -----------------------------------------------------------------------------
# ls
# -----------------------------------------------------------------------------

multi sub MAIN('ls', 'holograms', Str :$holograms-dir)
{
    .say for Holovault::Config.ls-holograms(:holograms-dir($holograms-dir));
}
multi sub MAIN('ls', 'keymaps') { .say for Holovault::Config.ls-keymaps; }
multi sub MAIN('ls', 'locales') { .say for Holovault::Config.ls-locales; }
multi sub MAIN('ls', 'partitions') { .say for Holovault::Config.ls-partitions; }
multi sub MAIN('ls', 'timezones') { .say for Holovault::Config.ls-timezones; }




# -----------------------------------------------------------------------------
# version
# -----------------------------------------------------------------------------

multi sub MAIN(Bool:D :$version! where *.so)
{
    say 'v' ~ $Holovault::VERSION;
    exit;
}




# -----------------------------------------------------------------------------
# usage
# -----------------------------------------------------------------------------

multi sub USAGE()
{
    constant $HELP = q:to/EOF/;
    Usage:
      holovault [-h] install

    Commands:
      help                        Show help for subcommands
      install                     Bootstrap Arch system with Holo
      ls                          List discovered holograms, keymaps, locales,
                                  partitions, timezones

    optional arguments:
      -h, --help                  print this help message
      --version                   print version and exit
    EOF
    say $HELP.trim;
}

multi sub USAGE('install')
{
    constant $HELP = q:to/EOF/;
    Usage:
      holovault --holograms="skreltoi amnesia"        \
                --username="live"                     \
                --userpass="your new user's password" \
                --rootpass="your root password"       \
                --vaultname="luckbox"                 \
                --vaultpass="your vault password"     \
                --hostname="luckbox"                  \
                --partition="/dev/sdb"                \
                --processor="other"                   \
                --graphics="intel"                    \
                --disktype="usb"                      \
                --locale="en_US"                      \
                --keymap="us"                         \
                --timezone="America/Los_Angeles"      \
                --augment                             \
                install

    optional arguments:
      --augment                   drop to Bash console mid-execution
      --disktype=DISK_TYPE        hard drive type
      --graphics=GRAPHICS         graphics card type
      --holograms=HOLOGRAMS       holograms (space separated)
      --holograms-dir=DIR_PATH    path to dir containing hologram subdirs
      --hostname=HOSTNAME         hostname
      --keymap=KEYMAP             keymap
      --locale=LOCALE             locale
      --partition=DEVICE_PATH     partition target for install
      --processor=PROCESSOR       processor type
      --rootpass=PASSWORD         root password
      --timezone=TIMEZONE         timezone
      --username=USERNAME         user name
      --userpass=PASSWORD         user password
      --vaultname=VAULT_NAME      vault name
      --vaultpass=PASSWORD        vault password
    EOF
    say $HELP.trim;
}

multi sub USAGE('ls')
{
    constant $HELP = q:to/EOF/;
    Usage:
      holovault ls keymaps
      holovault ls locales
      holovault ls partitions
      holovault ls timezones
    EOF
    say $HELP.trim;
}

# vim: ft=perl6
